$(document).ready(function(){function e(){$(".intro_overlay").fadeOut(),$(".img_caption_wrapper").fadeOut(),_&&clearInterval(_)}function n(){$(".intro_overlay").fadeIn(),$(".img_caption_wrapper").fadeIn(),$(".intro_overlay").click(function(){e()}),$(".img_caption_wrapper").click(function(n){"intro_content"!==$(n.target).attr("id")&&"cp_wrapper"!==$(n.target).attr("id")||e()}),$(".close_button").click(function(){e()}),$(".intro_label").click(function(e){var n=$(e.target).attr("id");$(e.target).attr("activelabel")||($(".active_label").removeAttr("activelabel"),$(".active_label").removeClass("active_label"),$(this).addClass("active_label"),$(".active_label").attr("activelabel",1),$(".info_slidee").animate({opacity:0},{complete:function(){$(".info_slidee").html(b[n]),k.slideTo(0)}}),$(".info_slidee").animate({opacity:1}))});var n=new Image;n.onload=function(){o()},n.src="https://cdn.huixinhuiyi.com/zhanshan/img/background.jpg"}function t(e,n,t,o){var i,a,c=1024,l=1300,s=$(window).width()-16,r=$(window).height()-120;e&&n&&t&&o&&(c=e,l=n,s=t,r=o);var u=c/l;return c>s&&l>r?s/r>u?i=(i=(a=r)*u).toFixed(0):a=(a=(i=s)/u).toFixed(0):c>s?l>r||c>s&&(a=(a=(i=s)/u).toFixed(0)):l>r?l>r&&(i=(i=(a=r)*u).toFixed(0)):(i=c,a=l),[i,a]}function o(){$(".bg_container").css("background-image",`url(https://cdn.huixinhuiyi.com/zhanshan/img/background.jpg)`),k.init(),k.on("move",function(){k.reload()}),$(".caption_intro").css("width",t()[0]),$(".bg_container").animate({width:t()[0],height:t()[1]},{complete:function(){$(".area_slidebar_wrapper").animate({opacity:1},{duration:1e3}),$(".caption_intro").animate({opacity:1},{duration:1e3}),_=setInterval(function(){k.reload()},300)}})}function c(){l()||$(".like").addClass("liked")}function l(){return!localStorage.getItem("zhanshan_liked")}function s(){l()?$.ajax({url:"data.php",method:"POST",data:{like:"zhanshan"},dataType:"JSON",success:function(e){var n=e;$(".count").text(n),localStorage.setItem("zhanshan_liked",1),c(),console.log("Database like_count loaded successfully!"),r("点赞成功！")},error:function(e){console.log(e)}}):r("赞过了 :)")}function r(e){$("#popup").text(e),$("#popup").fadeIn(),setTimeout(function(){$("#popup").fadeOut()},1500)}function u(e){void 0!==document.fullScreenElement&&null===document.fullScreenElement||void 0!==document.msFullscreenElement&&null===document.msFullscreenElement||void 0!==document.mozFullScreen&&!document.mozFullScreen||void 0!==document.webkitIsFullScreen&&!document.webkitIsFullScreen?e.requestFullScreen?e.requestFullScreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT):e.msRequestFullscreen&&e.msRequestFullscreen():document.cancelFullScreen?document.cancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()}var d=new Image,p=new Image,m=new Image;p.onload=function(){$("#size_control").css({width:`${t(572,929,.8*$(window).width(),.8*$(window).height())[0]}px`,height:`${t(572,929,.8*$(window).width(),.8*$(window).height())[1]}px`}),$("#start_title").fadeIn(),$("#start_deco").fadeIn()},d.src="https://cdn.huixinhuiyi.com/zhanshan/img/start_title.png",p.src="https://cdn.huixinhuiyi.com/zhanshan/img/door_deco.png",m.src="https://cdn.huixinhuiyi.com/zhanshan/img/touch_tip.png",$("#start_up").click(function(){$(this).animate({opacity:0},{duration:1e3,complete:function(){$(this).css("display","none")}}),setTimeout(function(){krpano.call("startup()")},1e3)});var g=function(){var e=[],n=new Sly($(".thumbs"),{horizontal:!0,mouseDragging:!0,touchDragging:!0,scrollBy:100,scrollTrap:!0,speed:300,swingSpeed:.1,releaseSwing:!0,elasticBounds:1,easing:"easeOutExpo"}),t=function(){var n;for(n=krpano.get("scene.count"),i=0;i<n;i++){var t={};t.name=krpano.get(`scene[${i}].name`),t.title=krpano.get(`scene[${i}].title`),t.thumburl=krpano.get(`scene[${i}].thumburl`),e.push(t)}},o=function(){if(e){var n=90*e.length;for($(".slidee").css("width",n+"px"),i=0;i<e.length;i++)$(".slidee").append(`<div class="thumb_wrapper" style="padding:4px;height:72px;width: 90px;float: left;">\n                <div class="thumb_${e[i].name}" noreaded="1" linkedscene="${e[i].name}" style="cursor: pointer;position:relative;border: 2px solid #FFFFFF;height:100%;width:100%;background-size: cover;background-position: center,center;background-image:url(${e[i].thumburl});opacity:1;">\n                    <div class="thumbs_01_text" style="pointer-events: none;width: 100%;position: absolute;bottom:0;text-align: center;background: rgba(0, 0, 0, 0.7);font-size: 12px;">${e[i].title}</div>\n                </div>\t\t\n        </div>`)}},a=function(){n.init()},c=function(){n.initialized&&n.reload()},l=function(){$(".thumbs").width()>$(".slidee").width()?$(".slidee").css("margin-left",($(".thumbs").width()-$(".slidee").width())/2+"px"):$(".slidee").css("margin-left","0px")},s=function(e){var n=krpano.get("xml.scene"),t=$(e.target).attr("linkedscene");n!=t&&krpano.call("loadscene("+t+", null, get(skin_settings.loadscene_flags), get(skin_settings.loadscene_blend))")},r=function(){$(".thumb_wrapper div").click(s),krpano.addEventListener("build",function(){var e=".thumb_"+krpano.get("xml.scene");parseInt($(".activethumb").attr("noreaded"))&&($(".activethumb").append(`<div style="pointer-events:none;position:absolute;top:2px;right:2px;height:16px;width:16px;background-image:url(https://cdn.huixinhuiyi.com/zhanshan/img/readed.png);background-size: cover;background-position: center,center;"></div>`),$(".activethumb").attr("noreaded",0)),$(".activethumb").removeClass("activethumb"),$(e).addClass("activethumb"),u(e)})},u=function(e){n.toCenter($(e),!1)};return{thumbsinit:function(){t(),o(),l(),r(),a(),$(".thumbs").css("opacity",1)},thumbsonresize:function(){c(),l()}}}(),h=function(){var e={iconcontainer:"#uprighticons",fullscreen:".fullscreen",music:".music",VR:".vrenter",gyro:".gyro",thumbs_toggle:".thumbs_toggle",thumbs_container:"#thumb_container"},n=!1,t=function(){var e=new Pizzicato.Sound({source:"file",options:{path:"music/merged_sutra.mp3",loop:!0}},function(t){t?console.log(t):($(".music").css("height","30px"),$(".music").click(function(){n?n&&e.pause():e.play()}),console.log("Music loaded sucessfully!"))});e.on("play",function(){n=!0,$(".music").addClass("mute")}),e.on("pause",function(){n=!1,$(".music").removeClass("mute")})},o=function(){$(".fullscreen")&&($(".fullscreen").click(function(){u(document.body)}),$(".thumbs_toggle").click(function(){$("#thumb_container").toggleClass("thumbs_closed"),$("#flower_contianer").toggleClass("flower_onthumbclosed"),$("#flower").toggleClass("flower_onthumbclosed"),$("#namotext").toggleClass("namotext_onthumbclosed")}))};return{init:function(){t(),o()},judge_vr_gryo:function(){krpano.addEventListener("vrava",function(){krpano.get("webvr.isavailable")&&($(e.VR).css("height","30px"),$(e.VR).click(function(){krpano.call("webvr.enterVR();")}))}),krpano.addEventListener("gyro",function(){krpano.get("plugin[skin_gyro].isavailable")&&($(".gyro").css("height","30px"),$(".gyro").click(function(){krpano.call("switch(plugin[skin_gyro].enabled); if(plugin[skin_gyro].enabled, skin_showmap(false));")}))})},judge_fullscreen:function(){krpano.get("device.fullscreensupport")&&$(".fullscreen").css("height","30px")}}}(),f=function(){var e=[],n=0;return{poly:function(){var t=krpano.get("mouse.x"),o=krpano.get("mouse.y"),i=krpano.screentosphere(t,o),a=i.x,c=i.y;if(krpano.get("hotspot[poly_test]")){krpano.set(`hotspot[poly_test].point[${n}].ath`,`${a.toFixed(4)}`),krpano.set(`hotspot[poly_test].point[${n}].atv`,`${c.toFixed(4)}`),krpano.call(`hotspot[poly_test].updatepos()`);l=`<point ath="${a.toFixed(4)}" atv="${c.toFixed(4)}"/>`;e.push(l),n++}else{krpano.call("addhotspot(poly_test)"),krpano.set(`hotspot[poly_test].point[${n}].ath`,`${a.toFixed(4)}`),krpano.set(`hotspot[poly_test].point[${n}].atv`,`${c.toFixed(4)}`);var l=`<point ath="${a.toFixed(4)}" atv="${c.toFixed(4)}"/>`;krpano.call(`hotspot[poly_test].updatepos()`),e.push(l),n++}},output_points:function(){var n="";for(a=0;a<e.length;a++)n=n.concat(e[a]);console.log(n)},delete_lastpoint:function(){if(krpano.get("hotspot[poly_test]")&&n>0){n-=1,krpano.call(`delete(hotspot[poly_test].point[${n}])`),krpano.call(`hotspot[poly_test].updatepos()`);var t=e.length-1;e.splice(t,1)}},init:function(){$(document).keydown(function(e){77==e.which&&f.poly()}),$(document).keydown(function(e){78==e.which&&f.output_points()}),$(document).keydown(function(e){66==e.which&&f.delete_lastpoint()})}}}();$(window).resize(function(){g.thumbsonresize()});var _,k=new Sly($(".show_area"),{touchDragging:!0,scrollBy:200,swingSpeed:.1,speed:500,releaseSwing:!0,elasticBounds:1,scrollTrap:!0,easing:"easeOutExpo",scrollBar:$(".scroll_bar_v"),dynamicHandle:!0}),b={temple:`<div style="width:100%;font-size:0px"><img src="https://cdn.huixinhuiyi.com/zhanshan/img/088_01.png" style="width:100%;height:auto;"/></div>\n    <div style="width:100%;font-size:0px"><img src="https://cdn.huixinhuiyi.com/zhanshan/img/088_02.png" style="width:100%;height:auto;"/></div>\n    <div style="width:100%;font-size:0px"><img src="https://cdn.huixinhuiyi.com/zhanshan/img/088_03.png" style="width:100%;height:auto;"/></div>\n    <div style="width:100%;font-size:0px"><img src="https://cdn.huixinhuiyi.com/zhanshan/img/088_04.png" style="width:100%;height:auto;"/></div>\n    <div style="width:100%;font-size:0px"><img src="https://cdn.huixinhuiyi.com/zhanshan/img/088_05.png" style="width:100%;height:auto;"/></div>\n    <div style="width:100%;font-size:0px"><img src="https://cdn.huixinhuiyi.com/zhanshan/img/088_06.png" style="width:100%;height:auto;"/></div>`,monk:`<div style="width:100%;font-size:0px"><img src="https://cdn.huixinhuiyi.com/zhanshan/img/099_01.png" style="width:100%;height:auto;"/></div>\n    <div style="width:100%;font-size:0px"><img src="https://cdn.huixinhuiyi.com/zhanshan/img/099_02.png" style="width:100%;height:auto;"/></div>`,wechat:`<div style="width:100%;font-size:0px"><img src="https://cdn.huixinhuiyi.com/zhanshan/img/0010.png" style="width:100%;height:auto;"/></div>`};!function(){$.ajax({url:"data.php",method:"POST",data:{scene:"zhanshan"},dataType:"JSON",success:function(e){var n=e;$(".count").text(n),console.log(n),console.log("Database like_count loaded successfully!")},error:function(){console.log("wrong")}})}(),c(),$("#like").click(s),document.addEventListener("krpanoready",function(){g.thumbsinit(),h.judge_vr_gryo()}),document.addEventListener("setskin",function(){$("#pano_skin").css("display","block"),g.thumbsonresize(),$("#pano_skin").animate({opacity:1},{duration:1500}),$(".info_slidee").html(b.temple),h.init(),h.judge_fullscreen(),f.init()}),$("#zhanshan_title,.info,.intro").click(function(){n()})});